{"version":3,"file":"phpepl.js","sources":["phpepl.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","Console","$element","this","$output","find","timestamp","prototype","setOutput","text","html","removeClass","setError","error","errorMsg","line","message","editor","showLineError","addClass","toggleSpinner","state","$spinner","fadeIn","fadeOut","./lib/timestamp",2,"Editor","_editor","window","CodeMirror","get","lineNumbers","matchBrackets","mode","indentUnit","tabSize","autofocus","autoCloseBrackets","getValue","setValue","val","each","Number","$",3,"getPrettyFatalErrorMessage","responseText","splitTokens","err","lineNum","tokensToReplace","toLowerCase","indexOf","idx","replace","split","trim",4,"saveCode","localStorage","setItem","mixpanel","track","getSavedCode","greeting","result","getItem","../editor",5,"now","Date","time","getHours","getMinutes","getSeconds","suffix","join",6,"sendingCode","ajax","type","url","evalURL","data","dataType","hostHas","part","location","host","isLiveEnv","onPHP5Version","processCode","console","done","processResponse","fail","processFatalError","res","textLine","editorHelpers","checkForShortcuts","which","ctrlKey","metaKey","preventDefault","storageHelpers","savedCode","document","keydown","unload","./console","./editor","./helpers/EditorHelpers","./helpers/StorageHelpers"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar timestamp = require('./lib/timestamp');\n\n/**\n * An output console\n * @param {$} $element\n */\nfunction Console($element) {\n  this.$element = $element;\n  this.$output = this.$element.find('.output-container span');\n}\n\n/**\n * @param {String} text\n */\nConsole.prototype.setOutput = function(text) {\n  this.$output\n  .html(text)\n  .removeClass('error');\n\n  this.$element.find('.timestamp span').html(timestamp());\n};\n\nConsole.prototype.setError = function(error) {\n  var errorMsg;\n\n  if (error.line && error.message) {\n    // Show the line in red\n    editor.showLineError(error.line);\n\n    // Show the error message\n    errorMsg = 'Line ' + error.line + ': ';\n  }\n\n  errorMsg += error.message;\n\n  this.setOutput(errorMsg);\n\n  this.$output.addClass('error');\n};\n\n/**\n * @param  {Boolean} state\n */\nConsole.prototype.toggleSpinner = function(state) {\n  var $spinner = this.$element.find('.spinner');\n\n  if (state) {\n    $spinner.fadeIn('fast');\n  } else {\n    $spinner.fadeOut('fast');\n  }\n};\n\nmodule.exports = Console;\n},{\"./lib/timestamp\":5}],2:[function(require,module,exports){\n/**\n * A code editor wrapper around Codemirror\n *\n * @param {$} $element - Dom element the editor should bind to\n * @returns {CodeMirror}\n */\nfunction Editor($element) {\n  this.$element = $element;\n\n  this._editor = window.CodeMirror(this.$element.get(0), {\n    lineNumbers:       true,\n    matchBrackets:     true,\n    mode:              'text/x-php',\n    indentUnit:        2,\n    tabSize:           2,\n    autofocus:         true,\n    autoCloseBrackets: true\n  });\n}\n\nEditor.prototype.getValue = function() {\n  return this._editor.getValue();\n};\n\nEditor.prototype.setValue = function(val) {\n  this._editor.setValue(val);\n};\n\n/**\n * Highlights the line in the gutter with the error\n *\n * @param  {Number} line\n */\nEditor.prototype.showLineError = function(line) {\n  // Find the dom element in the gutter\n  this.$element.find('.CodeMirror-linenumber').each(function() {\n    // If the cell's line number matches the error line\n    if (Number($(this).html()) === line) {\n      // Make the background red\n      $(this).addClass('error-gutter');\n      return;\n    }\n  });\n};\n\nmodule.exports = Editor;\n\n},{}],3:[function(require,module,exports){\n// Helper to show the fatal errors nicely\n// Returns a list of the error text and line number that\n// generated the error.\n// Note: Implementation is fairly naive but works\nmodule.exports.getPrettyFatalErrorMessage = function(responseText) {\n  if (!responseText.length) { return; }\n\n  var text = responseText;\n  var tokensToReplace = ['\\n', /<br \\/>/g, /<b>/g, /<\\/b>/g, /(Fatal error: +)/g];\n  var splitTokens;\n  var err;\n  var line;\n  var lineNum;\n\n  // If the error message doesn't contain 'fatal error',\n  // then just print it\n  if (!responseText.toLowerCase().indexOf('fatal error')) {\n    return [responseText, 1];\n  }\n\n  $.each(tokensToReplace, function(idx, val) {\n    text = text.replace(val, '');\n  });\n\n  splitTokens = text.split('in');\n  err = splitTokens[0].trim();\n  splitTokens = text.split('on');\n  line = splitTokens[1].trim();\n\n  text = (err + ' on ' + line).trim();\n\n  lineNum = line.split(' ');\n  lineNum = Number(lineNum[1]);\n\n  return [text, lineNum];\n};\n\n},{}],4:[function(require,module,exports){\nvar editor = require('../editor');\n\nmodule.exports.saveCode = function(code) {\n  if (!window.localStorage) { return; }\n\n  window.localStorage.setItem('code', code);\n\n  // Show the saved message\n  $('.timestamp')\n    .find('span')\n      .html('Code Saved!');\n\n  window.mixpanel.track('Code Saved');\n};\n\n// Preload where you last left off\nmodule.exports.getSavedCode = function() {\n  if (!window.localStorage) { return; }\n\n  var greeting = 'echo \"We\\'re running php version: \" . phpversion();';\n  var result = window.localStorage.getItem('code');\n\n  return !result ? greeting : result;\n};\n\n},{\"../editor\":2}],5:[function(require,module,exports){\n/**\n * Returns a pretty timestamp (only time)\n * @return {String}\n */\nmodule.exports = function() {\n  var now = new Date();\n  var time = [now.getHours(), now.getMinutes(), now.getSeconds()];\n  var suffix = time[0] < 12 ? 'AM' : 'PM';\n\n  // Convert hour from military time\n  time[0] = time[0] < 12 ? time[0] : time[0] - 12;\n\n  // If hour is 0, set it to 12\n  time[0] = time[0] || 12;\n\n  // If seconds and minutes are less than 10, add a zero\n  for (var i = 1; i < 3; i++) {\n    if (time[i] < 10) {\n      time[i] = '0' + time[i];\n    }\n  }\n\n  return time.join(':') + ' ' + suffix;\n}\n},{}],6:[function(require,module,exports){\n'use strict';\n\nvar Editor = require('./editor');\nvar Console = require('./console');\nvar editorHelpers = require('./helpers/EditorHelpers');\nvar storageHelpers = require('./helpers/StorageHelpers');\n\nvar editor = new Editor($('#editor'));\nvar console = new Console($('.console'));\n\nvar mixpanel = window.mixpanel || {};\nvar evalURL = 'eval/index.php';\n\nvar savedCode = storageHelpers.getSavedCode();\nif (savedCode) {\n  editor.setValue(savedCode);\n}\n\nif (!onPHP5Version() && isLiveEnv()) { $('.link-to-heroku').fadeIn('fast'); }\n\n$(document).keydown(checkForShortcuts);\n\n// Remember the code in the editor before navigating away\n$(window).unload(function() {\n  storageHelpers.saveCode(editor.getValue());\n});\n\n// Helpers\nfunction sendingCode(code) {\n  return $.ajax({\n    type:     'POST',\n    url:      evalURL,\n    data:     {code: code},\n    dataType: 'json'\n  });\n}\n\nfunction hostHas(part) {\n  return window.location.host.indexOf(part) !== -1;\n}\n\nfunction isLiveEnv() {\n  return hostHas('cloudcontrolled') || hostHas('herokuapp');\n}\n\nfunction onPHP5Version() {\n  return hostHas('herokuapp');\n}\n\n// Handles the sending of the code to the eval server\nfunction processCode() {\n  var code = editor.getValue();\n\n  if (!code.length) {\n    console.setOutput('Please supply some code...');\n    return;\n  }\n\n  console.toggleSpinner(true);\n\n  // Track it\n  mixpanel.track('Code Run', {code: code});\n\n  sendingCode(code)\n    .done(processResponse)\n    .fail(processFatalError);\n}\n\nfunction processResponse(res) {\n  if (!res) { return; }\n\n  if (!res.error) {\n    console.setOutput(res.result);\n\n  } else {\n    console.setError(res.error);\n    console.toggleSpinner(false);\n  }\n}\n\nfunction processFatalError(error) {\n  if (!error) { return; }\n\n  var textLine = editorHelpers.getPrettyFatalErrorMessage(error.responseText);\n\n  console.setOutput(textLine[0], true);\n  console.toggleSpinner(false);\n  editor.showLineError(textLine[1]);\n  mixpanel.track('Error', {error: error.responseText});\n}\n\nfunction checkForShortcuts(e) {\n  // CMD + Enter or CTRL + Enter to run code\n  if (e.which === 13 && (e.ctrlKey || e.metaKey)) {\n    processCode();\n    e.preventDefault();\n  }\n\n  // CMD + S or CTRL + S to save code\n  if (e.which === 83 && (e.ctrlKey || e.metaKey)) {\n    storageHelpers.saveCode();\n    e.preventDefault();\n    mixpanel.track('Save Shortcut');\n  }\n}\n\n},{\"./console\":1,\"./editor\":2,\"./helpers/EditorHelpers\":3,\"./helpers/StorageHelpers\":4}]},{},[6]);\n"]}